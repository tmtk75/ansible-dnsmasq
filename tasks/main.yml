---
# tasks for dnsmsq
- name: yum
  yum: name=dnsmasq
  tags:
    - dnsmasq
    - dnsmasq.yum

- name: /etc/resolv.conf
  lineinfile: dest=/etc/resolv.conf insertafter='^; generated by' line='nameserver 127.0.0.1'
  tags:
    - dnsmasq
    - dnsmasq.resolv.conf

- name: PEERDNS=no in /etc/sysconfig/network-scripts/ifcfg-eth0
  lineinfile: dest=/etc/sysconfig/network-scripts/ifcfg-eth0
              state=present backrefs=yes
              regexp='^PEERDNS='
              line='PEERDNS="no"'
  tags:
    - dnsmasq
    - dnsmasq.ifcfg

- name: /etc/nsswitch.conf
  lineinfile: 'dest=/etc/nsswitch.conf
               state=present backrefs=yes
               regexp="^hosts:"
               line="hosts:      dns files"'
  tags:
    - dnsmasq
    - dnsmasq.nsswitch

- name: dnsmasq.conf
  template: src=./etc/dnsmasq.conf dest=/etc/dnsmasq.conf
  notify:
    - restart dnsmasq
  tags:
    - dnsmasq
    - dnsmasq.config

- name: enable
  command: /bin/systemctl enable dnsmasq.service
  when: ansible_distribution_major_version == "7"
  tags:
    - dnsmasq
    - dnsmasq.enable

- name: service
  service: name=dnsmasq state=started
  tags:
    - dnsmasq
    - dnsmasq.service
